plugins {
    id "org.jetbrains.kotlin.jvm" version "1.3.41"
}
apply plugin: 'java'

repositories { mavenCentral() }

sourceSets {
    test {
        resources {
            srcDir "src/main/protelis"
        }
    }
}

dependencies {
    implementation("it.unibo.alchemist:alchemist:$alchemistVersion")
    testImplementation "io.kotlintest:kotlintest-runner-junit5:$junitVersion"
}

task classpathJar(type: Jar) {
    archiveName = "classpath.jar"
    doFirst {
        manifest {
            attributes "Class-Path": files(configurations.runtimeClasspath).collect { name ->
                name.toURI()
            }.join(" ")
        }
    }
}

task runAlchemist(type: JavaExec) {
    // clean up the classpath because the launcher jar has it.
    classpath = files(classpathJar.archivePath, sourceSets.main.java.outputDir)
    classpath 'src/main/protelis'
    main = 'it.unibo.alchemist.Alchemist'
    args("-y", "src/main/yaml/${simulation}.yml", "-g", "effects/${simulation}.aes")
}
runAlchemist.dependsOn(compileJava)
runAlchemist.dependsOn(classpathJar)

defaultTasks('runAlchemist')

test {
    useJUnitPlatform()
}
